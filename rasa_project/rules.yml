version: "3.1"

rules:

- rule: start emergency menu
  steps:
    - intent: emergency
    - action: action_clear_slots
    - action: utter_type_emergency

- rule: restart conversation completely
  steps:
    - intent: restart
    - action: action_restart

- rule: greet normally
  steps:
    - intent: greet
    - action: action_greet_and_restart

# ---- Crisis menu wrong input fallback (3rd fallback) ----
- rule: crisis menu fallback
  condition:
    - slot_was_set:
        - crisis_type: null
  steps:
    - action: utter_type_emergency
    - intent: nlu_fallback
    - action: utter_select_crisis_type

# ---- Form control rules ----
- rule: activate crisis form earthquake
  condition:
    - slot_was_set:
        - crisis_type: earthquake
  steps:
    - action: crisis_form
    - active_loop: crisis_form

- rule: activate crisis form flood
  condition:
    - slot_was_set:
        - crisis_type: flood
  steps:
    - action: crisis_form
    - active_loop: crisis_form

- rule: activate crisis form fire
  condition:
    - slot_was_set:
        - crisis_type: fire
  steps:
    - action: crisis_form
    - active_loop: crisis_form

- rule: activate crisis form power outage
  condition:
    - slot_was_set:
        - crisis_type: power_outage
  steps:
    - action: crisis_form
    - active_loop: crisis_form

- rule: submit crisis form
  condition:
    - active_loop: crisis_form
  steps:
    - action: crisis_form
    - active_loop: null
    - slot_was_set:
        - requested_slot: null
    - action: action_calculate_risk_level
    - action: utter_offer_more_steps

# ---- More steps handling ----
- rule: user wants more steps
  steps:
    - intent: more_steps_yes
    - action: action_finish_and_guide

- rule: user declines more steps
  steps:
    - intent: more_steps_no
    - action: utter_goodbye

- rule: handle goodbye
  steps:
    - intent: goodbye
    - action: utter_goodbye

- rule: human handover
  steps:
    - intent: request_human
    - action: utter_human_handover

# ---- Out of scope (2nd fallback) ----
- rule: out of scope
  steps:
    - intent: out_of_scope
    - action: utter_out_of_scope

# ---- NLU fallback (1st fallback) ----
- rule: nlu fallback
  steps:
    - intent: nlu_fallback
    - action: utter_fallback
